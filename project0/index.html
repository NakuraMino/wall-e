
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />

<script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
<script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.js"></script>

<script type="text/javascript">

  // global variables 
  var globalPos = [];
  var globalSec = 0;
  var globalJ3P = 0.0; //joint3 position
  var globalGripper = 0.0;

  // Connecting to ROS
  // -----------------
  var ros = new ROSLIB.Ros({ 
    url : 'ws://localhost:9090' // This needs to be changed to whatever the correct url is 
  });

// Calling a service
// -----------------

  var jointMover = new ROSLIB.Service({
    ros : ros,
    name : '/open_manipulator/goal_joint_space_path_from_present',
    serviceType : 'open_manipulator_msgs/SetJointPosition'
  });

  var request = new ROSLIB.ServiceRequest({
    planning_group : jointMover,
    joint_position : {
      joint_name : ['gripper', 'gripper_sub', 'joint1', 'joint2', 'joint3', 'joint4'], 
      position: [0.1, 0.0, 0.0, 0.0, 0.0, 0.0],
      max_accelerations_scaling_factor : 0.1, 
      max_velocity_scaling_factor : 0.1
    },
    path_time : 2.00
  });

  jointMover.callService(request, function(result) {
    console.log('Result for service call: '
    + result);
  });

  
  // Subscribing to a Topic

  var poseListener = new ROSLIB.Topic({
    ros: ros,
    name : '/open_manipulator/joint_states',
    messageType : 'sensor_msgs/JointState'
  });
  
  poseListener.subscribe(function(message) {
    globalPos = message.position;
    globalSec = message.header.stamp.secs;
    });

  var joint3List = new ROSLIB.Topic({
    ros: ros,
    name : '/open_manipulator/joint3_position/command',
    messageType : 'std_msgs/Float64'
  });
  
  joint3List.subscribe(function(message) {
    globalJ3P = message.data;
    //console.log("joint3pos: " + globalJ3P); 
    });

  var gripperList = new ROSLIB.Topic({
    ros: ros,
    name : '/open_manipulator/gripper_position/command',
    messageType : 'std_msgs/Float64'
  });
  
  gripperList.subscribe(function(message) {
    globalGripper = message.data;
    if (globalGripper == -0.01) {
      console.log("Did it change?"); 
    }
    //console.log("gripper: " + globalGripper); 
    });

  // Publishing a Topic
  // ------------------

  // publisher Topic object 
  var joint1Pos = new ROSLIB.Topic({
    ros : ros,
    name : '/open_manipulator/joint1_position/command',
    messageType : 'std_msgs/Float64'
  });

  var joint2Pos = new ROSLIB.Topic({
    ros : ros,
    name : '/open_manipulator/joint2_position/command',
    messageType : 'std_msgs/Float64'
  });

  var joint3Pos = new ROSLIB.Topic({
    ros : ros,
    name : '/open_manipulator/joint3_position/command',
    messageType : 'std_msgs/Float64'
  });

  var joint4Pos = new ROSLIB.Topic({
    ros : ros,
    name : '/open_manipulator/joint4_position/command',
    messageType : 'std_msgs/Float64'
  });
  


  // payload to be publish 
  var twist = new ROSLIB.Message({
    data : 0.0
  });

  function moveJoint3() {
    console.log("in method: " + globalJ3P);
    twist.data = globalJ3P + 0.1;
    joint3Pos.publish(twist);
    console.log("published");
  }

  var gripChange = new ROSLIB.Message({
    data : 0.0
  });
  
  function changeGripper() {
    gripChange.data = globalGripper * -1;
    gripperList.publish(gripChange);
  }



</script>

</head>

<body>
    <button type="button" onclick="changeGripper()">open/close gripper</button> 

</body>

</html>

